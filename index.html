<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="houjingyi">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="houjingyi">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="houjingyi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>houjingyi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">houjingyi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/05/%E6%9C%80%E8%BF%91%E6%8D%A2%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/05/%E6%9C%80%E8%BF%91%E6%8D%A2%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">工作三年的回顾和换工作的思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-05 11:08:33" itemprop="dateCreated datePublished" datetime="2021-08-05T11:08:33+08:00">2021-08-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>写完这篇文章的时候我从360离职加入某甲方已经1个月了，随便聊聊工作三年的回顾和换工作的思考吧。</p>
<h2 id="工作三年的回顾"><a href="#工作三年的回顾" class="headerlink" title="工作三年的回顾"></a>工作三年的回顾</h2><p>先简单说一下自己的情况，2017年4月份左右的时候我大三，开始找实习。读书那会儿其实我真正接触安全的时间比较短，虽然说是信息安全专业，但是由于学校课程设置和没人指导等原因，大一大二基本相当于打酱油了。大二暑假的时候我才知道安全基本上就两个大的方向，web安全和二进制安全。我当时就是觉得汇编代码读起来比PHP简单，所以就决定研究二进制安全。等到我找实习那会儿真正搞二进制安全也就不到一年的时间，我找实习的时候也压根没有指望能找到实习，因为知道自己确实很菜，别人要么都是已经挖了好多漏洞要么打过好多CTF，我就啥都没有。当时主要就是不想考研，找找实习试试。记得我当时面试了腾讯，天融信，360，宜信和网康(应该就这几个吧，有点记不清楚了)。最后来360也算是阴差阳错，开始面试的是企业安全那边(也就是现在的奇安信)，然后又说不太合适让我去面试CERT，当时光哥问我一些问题其实我也有很多没答上来，但是最后还是让我来了。幸好自己在学校那会儿调试了一些漏洞，读了《0day安全》《逆向工程核心原理》《恶意代码分析实战》等几本书，勉勉强强算是达到了实习生的要求吧。<br>从来实习一直到2018年下半年主要是做样本分析，后来还和同事去xkungfoo分享过一些分析技巧。这一年的时间对我最大的影响是逆向分析的基本能力和重复性工作的自动化。特别是像当时影响非常大的Xshell后门，我们几个人分析了好几周还是一头雾水，现在想想也就是那么回事。但是样本分析这个事情时间一长也就厌倦了，加上自己也分析了不少漏洞，所以后来就在光哥和redrain支持下开始专门研究挖洞。<br>最开始是redrain跟我提过可以研究Windows RPC的洞，自己搞了几个月只搞出来两个BSOD后来也没坚持下去，但是他跟我说过的做研究的方法我现在还记得。我一直想挖内核的洞，后来研究了几个月，直到2019年5月出了bluekeep这个洞，想怎么利用我也想了很久，不过很惭愧，能力有限，最后也是在2019年9月有了公开EXP之后我才发的分析报告。2019年快年底的时候我想，既然还没有能力挖到内核的洞，那我先挖用户态的洞行不行？如果我用户态的内存损坏漏洞也挖不出来，那我先挖用户态的纯逻辑类漏洞总可以了吧？所以就挖了差不多一年的PC端厂商的各种逻辑漏洞，本地提权的比较多，也有几个RCE。2020年下半年的时候我决定研究fuzz，直到现在研究fuzz差不多也有一年的时间，macOS/Windows/IOT上的目标也都有一些收获。不过有点遗憾的是我还是没有挖过内核的洞；并且虽然有几个我挖的洞面试的时候说出来也有面试官认可，表示我的思路确实比较清奇，但是我并没有做过像浏览器RCE/虚拟机逃逸这样的更高难度目标的从挖掘到利用的一个完整流程。<br>基本上这就是我在360这3年(算上实习4年：样本分析1年，研究挖洞3年)干过的事情了，更详细的内容可以在<a target="_blank" rel="noopener" href="https://houjingyi233.com/about/">https://houjingyi233.com/about/</a>上面找到。</p>
<h2 id="为什么想换工作"><a href="#为什么想换工作" class="headerlink" title="为什么想换工作"></a>为什么想换工作</h2><p>第一个原因是觉得研究挖洞带来的价值太小了。如果不是护网公司也许能用到你的漏洞，研究挖洞基本可以说无法给公司带来其他价值。你自己能够有CVE，有奖金，有名誉，公司能有什么呢？给公司带来的价值难道只有发PR稿吗？更何况就算是护网比较好用的也都是web的洞。刚毕业那会儿就觉得挖洞很牛逼，但是现在不是这样想的了。<br>第二个原因是觉得自己研究挖洞欠缺一些天赋。如果我再继续做研究做个3年5年当然也能取得进步，但是很多同龄人甚至年纪比我小的人取得的成绩我现在已经赶不上了。我这样能力一般的和做研究能力顶尖的同学产出差别是很大的。能力顶尖的同学一年能挖几十个甚至上百个那几大厂商的洞，而我一年可能最多也就挖十个二十个，漏洞质量还没人家的好。很多挖洞的师傅奖金收入是超过甚至远远超过工资的，而我只是挣个零花钱的水平。<br>这是两个主要原因，还有几个次要原因，比如大环境的原因：在17年我刚刚实习那会儿做研究还是比较流行的，但是这几年好像大家都在去做防御去做业务了。</p>
<h2 id="几次面试的经历"><a href="#几次面试的经历" class="headerlink" title="几次面试的经历"></a>几次面试的经历</h2><p>去年年底光哥走了以后我被转到漏洞研究院那边，那个时候是第一次产生离职的想法，简历改好了也想了一下面试可能问什么该怎么答。端午节过后我正式开始找工作，我的想法很简单：不管是什么样的工作内容，反正我是非走不可的；当然比起挖洞能更有一些实际的价值是最好的。除了我现在所在的甲方A就不说了，其他接触过的4个甲方谈的过程可以和大家简单聊聊。主要用到的工具就是脉脉和boss。当然如果你有同学朋友内推也是很不错的。</p>
<p>甲方B：甲方B是我第一个面试。可以说10个猎头给你发消息，6个都是推的甲方B的岗位。我感觉我认识的很多人要么是从甲方B离职了要么就是跳到甲方B了。我也是通过boss上猎头给的简历，非常快，周日就约了周一晚上视频面试。和面试官就简历上聊了半个小时，最后面试官让我写个排序，当时我确实直接懵了。脉脉上经常调侃甲方B的面试上来就是写红黑树或者写leetcode的hard，相比起来只写个排序而且什么排序都行确实不是一个过分的要求。但是我没有想到会让我写算法，也没有准备，所以没写出来，再加上面试官应该是并不认为我之前工作的成果很出色，最后面试就挂了。我只能说我大一的时候会写，工作以后确实从来没有接触过算法了……</p>
<p>甲方C：甲方C是去年某大厂独立出来的一个子品牌，应该算是中厂吧。我看甲方C的JD主要还是android和IOT，自己这一块经验很少，所以本来是没有打算投的。boss上HR给我发消息，我说android和IOT我不太会，但是HR说有二进制漏洞和逆向经验就行，所以我就给了简历，然后约了视频面试。一面是3个人面，当时我打开摄像头一下看到坐着3个人就紧张起来了。3个人应该是1个部门领导，1个部门员工和1个HR。二面是隔级领导面试，就没有问什么技术上的问题了，主要就是聊聊企业的价值观之类的。两次都差不多聊了1个小时左右。最后我没有去甲方C主要原因是甲方C在深圳，我有点不想跑那么远。但是总的来说甲方C面试体验还是非常不错的，从给简历到发意向offer差不多只用了两周的时间。</p>
<p>甲方D：通过脉脉投的简历。虽然JD不太符合，但是我想着反正无所谓先投了再说呗。一面上来问我UPX怎么脱壳还有ESP脱壳定律，我都几年没脱过壳了只能说忘了，搞得有点尴尬。后来又问了一些简历上的，最后面试官介绍工作内容是公司内部终端安全这一块。二面的时候聊了一会，然后面试官说工作内容有样本分析，我当时马上表示自己不愿意再做样本分析这样的工作，我以为一面的时候跟我说的终端安全可能是流量检测，看看告警，漏洞应急这样的，没有想到还要去做样本分析。面试官也表示理解，所以算是双向拒绝了。</p>
<p>甲方E：通过boss投的简历。聊了差不多一个小时，也只能说中规中矩吧，面试官说他们对二进制这方面的需求主要是护网和自研Windows/macOS的EDR。面试应该是没有通过，但是我也一直没有收到面试没有通过的邮件。不过也所谓了，本来我也不愿意做这个方向。</p>
<p>还接触了几个乙方，某个乙方一位前辈看到我的博客然后加了我的微信，问我愿不愿意去，并且说我可以过去看看，聊聊天。我知道有前同事和上一届的学长在那边，所以我就去了。那天在那边聊了挺久的，也收获了很多东西。最后我决定不去，真的觉得挺不好意思的。</p>
<p>几点感想：</p>
<p>1.很多东西不可能全部堆到简历上，blog能给面试官提供更多你的信息，因为确实有不止一个面试官一边面试一边翻我的blog。留个联系方式也相当于是交个朋友。<br>2.学校这一点对于社招来说只要都是本科一本二本什么的其实都没差别，当然学校越好给人印象肯定会更好一点。甲方C二面的时候面试官就表示在他们那个年代北邮还是很牛的。<br>3.不管面试还是被面试，最好还是能视频，这样双方都能接收和表达更多的信息。我面试别人之前都是电话，觉得电话还是视频都没什么区别，但是自己去面试的时候有些面试官视频面试没开视频，能明显感觉到开不开视频差别挺大的。<br>4.我这一次从开始投简历到确定去哪家总共用了一个多月，时间更长我也可能也受不了了。一方面是因为翻来覆去也就是那些问题，简历上的东西自己不知道说了多少遍，几个被问到比较多的又不会的短时间之内很难去突击(后面会说)，所以最后一两次面试人已经麻木了；另一方面是一般大家不会裸辞，你找工作这段时间对你工作状态还是有影响的，这也不太好。第一次面试可能会紧张，加上准备可能不充分，所以可能表现不会很好。所以如果有特别想去的坑的话建议安排在第三家，这个时候状态应该是最好的。<br>5.不用太纠结JD的问题，工作时间不长，JD不是非常符合的岗位有意向也可以投简历，而且如果简历没问题的话很多都会让你面试的。一般有这么几种情况：一是很多JD写的非常不清楚，厂商的需求和JD可能完全不是一回事，你可能只有面试聊的时候才会知道具体要去干什么；二是厂商可能看了你的简历之后觉得虽然你不适合投的岗位，但是有其他适合的岗位可以让你来面；三是厂商可能会觉得虽然你和厂商的需求不是特别匹配，但是你工作时间不长，而且可能觉得你学习能力适应能力不错，所以也会让你面。如果是想换大方向(比如开发到产品，二进制到web)还是得慎重一点，而且自己积累不够的话也不太好换；如果是想换小方向(比如研究Windows漏洞挖掘到Windows EDR开发，都还是属于二进制这一块)问题应该是不大的。</p>
<h2 id="被问到比较多的问题"><a href="#被问到比较多的问题" class="headerlink" title="被问到比较多的问题"></a>被问到比较多的问题</h2><p>1.符号执行。我完全不懂。</p>
<p>2.条件竞争漏洞挖掘。我接触过的：纯逻辑类的条件竞争漏洞，比如通过TOCTTOU替换可执行文件之类的；内存损坏的条件竞争漏洞我读过的论文和代码好像也就只有专门挖内核double fetch洞的bochspwn。特别是内存损坏的条件竞争漏洞我积累确实不多，也没有挖过这种洞。</p>
<p>如果要面大型甲方的非安全研发类的岗位，建议还是复习一下排序/链表/二叉树等等这些基础的都能写就行，应该不到半天时间就复习完了。如果只面乙方或者中小型甲方的的非安全研发类的岗位这方面应该就不用准备了。安全研发类的岗位算法可能还会问更复杂的。还有其他二进制漏洞相关岗位面试会问的比较常规的问题就不再细说，比如几大fuzzer的原理，常见保护措施绕过方法，常见漏洞类型利用方法，自己挖过的思路比较独特的漏洞等等。如果你是专门做某一个方向二进制漏洞挖掘的，比如浏览器/Windows内核等等，那么你做的那个方向的漏洞挖掘和利用的手段你也应该非常熟悉。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>我记得光哥开会的时候说过，大概意思就是每半年应该思考一下自己接下来应该继续做什么方向，我觉得这是很有必要的。无论是选择做什么方向，希望大家都能找到适合自己的路。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/01/new-dll-hijacking-scenario-found-by-accident/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/01/new-dll-hijacking-scenario-found-by-accident/" class="post-title-link" itemprop="url">new dll hijacking scenario found by accident</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-01 14:45:41" itemprop="dateCreated datePublished" datetime="2021-08-01T14:45:41+08:00">2021-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:55:08" itemprop="dateModified" datetime="2021-08-05T09:55:08+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Speaking of dll hijacking, many people may think it is very useless. </p>
<p>Some times ago, I accidentally discovered vulnerabilities in dll loading mechanism in cisco webex teams/IBM Db2/VMware ThinApp that can lead to LPE, and as far as I know, no one has ever mentioned this kind of dll hijacking scenario before.</p>
<p>Vendor advisories:</p>
<p><a target="_blank" rel="noopener" href="https://www.vmware.com/security/advisories/VMSA-2021-0015.html">VMware ThinApp update addresses a DLL hijacking vulnerability</a><br><a target="_blank" rel="noopener" href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-webex-teams-dll-drsnH5AN">Cisco Webex Teams Client for Windows DLL Hijacking Vulnerability</a><br><a target="_blank" rel="noopener" href="https://www.ibm.com/support/pages/node/6370023">Security Bulletin: IBM® Db2® could allow a local authenticated attacker to execute arbitrary code on the system, caused by DLL search order hijacking vulnerability in Microsoft Windows client. (CVE-2020-4739)</a></p>
<p>Details I posted to full disclosure mailing list:</p>
<p><a target="_blank" rel="noopener" href="https://seclists.org/fulldisclosure/2021/Jul/35">VMware ThinApp DLL hijacking vulnerability</a><br><a target="_blank" rel="noopener" href="https://seclists.org/fulldisclosure/2021/Feb/73">IBM(R) Db2(R) Windows client DLL Hijacking Vulnerability(0day)</a><br><a target="_blank" rel="noopener" href="https://seclists.org/fulldisclosure/2020/Oct/16">Cisco Webex Teams Client for Windows DLL Hijacking Vulnerability</a></p>
<p>I will not repeat the details of these vulnerabilities, I will analyze the dll path processing mechanism in ntdll.dll. </p>
<p>In <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">document</a> microsoft said:</p>
<p>The first directory searched is the directory containing the image file used to create the calling process (for more information, see the CreateProcess function). Doing this allows private dynamic-link library (DLL) files associated with a process to be found without adding the process’s installed directory to the PATH environment variable. If a relative path is specified, the entire relative path is appended to every token in the DLL search path list. <strong>To load a module from a relative path without searching any other path, use GetFullPathName to get a nonrelative path and call LoadLibrary with the nonrelative path.</strong> For more information on the DLL search order, see Dynamic-Link Library Search Order.</p>
<p>So…What will happen if we provide a relative path to LoadLibrary?</p>
<p>Let us take following code in VMware ThinApp as example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadLibraryExW(<span class="string">L&quot;\\DummyTLS\\dummyTLS.dll&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>The process is:KernelBase!LoadLibraryExW-&gt;ntdll!LdrpLoadDll-&gt;ntdll!LdrpPreprocessDllName:</p>
<p><img src="https://z3.ax1x.com/2021/07/16/WMWmcQ.png"></p>
<p>So RtlDetermineDosPathNameType_Ustr will return 4(RtlPathTypeRooted) and LdrpGetFulPath will return C:\DummyTLS\dummyTLS.dll. You can refer to code in ReactOS:<a target="_blank" rel="noopener" href="https://github.com/mirror/reactos/blob/master/reactos/lib/rtl/path.c">https://github.com/mirror/reactos/blob/master/reactos/lib/rtl/path.c</a>.</p>
<p><img src="https://z3.ax1x.com/2021/07/16/WMfdxg.md.png"></p>
<p>So now we know Windows will treat relative path in LoadLibrary/AddDllDirectory…as the path rooted relative to the current disk designator, which is usually C:\. Since non-admin user can create directory under C:\ and write file to it, this cause LPE.</p>
<p>I also reported my findings to MSRC, but MSRC said this is the default behavior. I am not surprised, if the default behavior is to let developers write vulnerable code, that’s fine.</p>
<p><img src="https://s1.ax1x.com/2020/10/09/0DQdxA.png"></p>
<p>I am sharing my discovery because I haven’t seen anyone mention these and similar vulnerabilities exist in other products absolutely. At the same time, I want to remind developers should make sure that all your dlls are loaded correctly.</p>
<p>Some thoughts:</p>
<p>1.I don’t understand why Microsoft handle path this way.</p>
<p>2.This kind of bug would not have appeared if developers had been more careful. </p>
<p>3.Using relative path is dangerous and I will share some RCE/LPE vulnerabilities I found because of relative path.</p>
<p>4.Non-admin user can create directory under C:\ and write file to it, this is not right and it caused many LPE vulnerabilities.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/13/macOS%E5%92%8CiOS%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/13/macOS%E5%92%8CiOS%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">macOS和iOS逆向环境搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-13 14:45:41" itemprop="dateCreated datePublished" datetime="2020-10-13T14:45:41+08:00">2020-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:44:17" itemprop="dateModified" datetime="2021-08-05T09:44:17+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近也在慢慢开始接触一些macOS/iOS安全，首先一个难题就是环境搭建。现在的情况是我有一台mac pro 13 2020和一个iphone8，分别记录一下vmware安装macOS虚拟机和iOS越狱降级这两个在调试macOS/iOS内核之前必须做的准备工作。</p>
<h2 id="vmware安装macOS虚拟机"><a href="#vmware安装macOS虚拟机" class="headerlink" title="vmware安装macOS虚拟机"></a>vmware安装macOS虚拟机</h2><p>目前主要有两种方式搭建macOS虚拟机：<br>1.在macOS物理机上能够使用vmware fusion/virtualbox或者vagrant搭建macOS虚拟机，说起来倒是很简单：用vmware fusion应该不会有什么坑，用virtualbox也有人把要踩的坑总结好了：<a target="_blank" rel="noopener" href="https://github.com/AlexanderWillner/runMacOSinVirtualBox">Run macOS 10.15 Catalina (and other versions) in VirtualBox on macOS</a>。用vagrant参考<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/terminal/151326.html">偏执的iOS逆向研究员：收集全版本的macOS iOS+越狱+内核调试</a>这篇文章即可。比较麻烦的是如果用vmware fusion/virtualbox的话sb苹果是不提供完整系统镜像的，得自己找；用vagrant的话又因为大家都知道的原因你得有一个很稳的梯子下那十几个G的镜像文件。<br>2.在linux/windows物理机上因为版权的原因默认是没有合法的手段让你装macOS虚拟机的，最最最常见的方法就是用unlocker patch掉vmware workstation pro然后安装macOS，当然镜像还是得自己找。推荐使用这个branch的unlocker：<a target="_blank" rel="noopener" href="https://github.com/BDisp/unlocker/releases">https://github.com/BDisp/unlocker/releases</a>，当前最新的版本是3.0.3。这个branch的unlocker据我测试应该是能直接用不会有什么坑。不过这里还是要注意一个问题，unlocker中的gettools.exe会去下载com.vmware.fusion.zip.tar并且下载速度很慢，我们可以先去把这个包下好，下载的地址是到<a target="_blank" rel="noopener" href="http://softwareupdate.vmware.com/cds/vmw-desktop/fusion">http://softwareupdate.vmware.com/cds/vmw-desktop/fusion</a>找你用的vmware workstation pro对应的版本即可。更改gettool.py的代码，把下载com.vmware.fusion.zip.tar的代码注释掉，用pyinstaller重新打包一个gettools.exe。以管理员权限运行win-install.cmd，在time.sleep(20)的时候把下载好的com.vmware.fusion.zip.tar拷贝进tools目录即可。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXagLd.png"></p>
<p>接下来就可以安装macOS了，这里我用的镜像是网上找的一个10.10.2的，如果提示你”没有足够的空间来进行安装”按照网上的方法抹掉vmware的硬盘即可：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wzl19870309/article/details/71194389">OS X Base System 上没有足够的空间来进行安装</a>。除此之外我没有遇到任何问题。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaReA.png"></p>
<p>最后就是安装VMware Tools了，gettools.exe已经下载好了darwin.iso和darwinPre15.iso，我的vmware workstation pro是15.5.1版的，应该用darwinPre15.iso。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXa6Qe.png"></p>
<p>关闭虚拟机，编辑虚拟机，设置CD/DVD，使用ISO映像为darwinPre15.iso。开启虚拟机之后会看到桌面的VMware Tools，直接安装就OK了。</p>
<p>很多时候如果你发现github上某个工具因为已经没有维护而不能使用的时候一个小技巧就是去看看issue或者pull request里面有没有人还在继续维护。本来最先搜到的是<a target="_blank" rel="noopener" href="https://github.com/theJaxon/unlocker">https://github.com/theJaxon/unlocker</a>，因为没有维护了所以遇到一点问题，在pull request里面找到了另外有人维护的<a target="_blank" rel="noopener" href="https://github.com/BDisp/unlocker">https://github.com/BDisp/unlocker</a>。去年也是，升级了vmware workstation pro之后<a target="_blank" rel="noopener" href="https://github.com/sysprogs/VirtualKD">https://github.com/sysprogs/VirtualKD</a>也没法用了，在issue里面找到了另外有人维护的<a target="_blank" rel="noopener" href="https://github.com/4d61726b/VirtualKD-Redux">https://github.com/4d61726b/VirtualKD-Redux</a>。想学习MachO文件格式，<a target="_blank" rel="noopener" href="https://github.com/gdbinit/MachOView">https://github.com/gdbinit/MachOView</a>早已无人维护，在issue里面找到了另外有人维护的<a target="_blank" rel="noopener" href="https://github.com/mythkiven/MachOView">https://github.com/mythkiven/MachOView</a>……感谢这些编写维护开源软件的大神，不然这些问题真是让人够头疼的。</p>
<h2 id="iOS越狱降级"><a href="#iOS越狱降级" class="headerlink" title="iOS越狱降级"></a>iOS越狱降级</h2><p>首先肯定大家都明白越狱是个什么意思，就和你研究android安全肯定需要有一台root过的手机一样，我们也需要一台越狱的iPhone。不过越狱有四种。</p>
<p>完美越狱(Tethered Jailbreak)<br>不完美越狱(Untethered Jailbreak)<br>半完美越狱(Semi-tethered Jailbreak)<br>半不完美越狱(Semi-untethered Jailbreak)</p>
<p>我画了个图，你一看就明白了。tether是拴绳拴链的意思，tethered就是需要数据线连电脑，untethered就是不需要数据线连电脑。</p>
<p><img src="https://s1.ax1x.com/2020/10/13/0feHeJ.png"></p>
<p>如果你不知道你的iPhone能不能越狱，你可以到这个网站上查：<a target="_blank" rel="noopener" href="https://canijailbreak.com/">https://canijailbreak.com/</a></p>
<p>一看之后你就会发现这几年出的越狱都是半不完美越狱，因为现在苹果的保护措施越来越完善，完美越狱有当然是有，但是能值很多钱，人家不会公开。这几年越狱界最大的新闻就是被称为史诗级漏洞的checkm8了，因为这个漏洞存在于BootROM中，无法通过软件更新的方式修复，所以理论上来讲只要你的iPhone在受影响的设备范围内，不管你怎么升级系统都能用这个漏洞越狱。我们直接去<a target="_blank" rel="noopener" href="https://checkra.in/">https://checkra.in/</a>下载越狱程序按照上面的说明来就可以了。越狱之后该在Cydia里面装什么等等网上都有很多文章了，这里就不再说了。</p>
<p>接下来说说怎么降级。降级不是你想降就能降的，iOS设备上的固件恢复需要配合Apple服务器进行校验，Apple停止公开验证某个固件版本时，iOS设备就不能从高版本恢复到停止验证的版本。iOS在更新设备固件的过程中会将设备的ECID等信息以及一个一次使用的nonce发送给Apple服务器，服务器在校验通过后会返回校验结果，结果使用非对称算法加密，在没有私钥的情况下无法解密也无法伪造。但是我们可以将校验结果保存下来，之后Apple不再提供此版本校验的时候重放校验过程，实现iOS降级到不提供验证的版本。</p>
<p>说了一大堆可能有点晕了，我们来实际操作一下。现在Apple只会验证最新的iOS 14.0.1版本，我的iPhone8是iOS 13，因为我以前没有保存校验结果，所以理论上现在我没有任何办法将我的iPhone8降级到一个更低的版本。但是现在我可以保存14.0.1的校验结果，假设说以后我的iPhone8升级到了iOS 14.0.2，理论上我就可以通过这个保存的校验结果降级到14.0.1。</p>
<p>首先checkra1n越狱之后我们添加repo:halo-michale.github.io/repo/，安装插件Generator Auto Setter，默认会写入Generator值为一串0x1把nonce固定，这样也方便我们以后降级。然后我们打开爱思助手查ECID：</p>
<p><img src="https://s1.ax1x.com/2020/10/13/0fta24.jpg"></p>
<p>点击查看设备详情查硬件模型：</p>
<p><img src="https://s1.ax1x.com/2020/10/13/0ft7If.jpg"></p>
<p>然后到<a target="_blank" rel="noopener" href="https://tsssaver.1conan.com/">https://tsssaver.1conan.com/</a>把这些信息填进去点击submit，就可以下载shsh2文件了。在将来的某个时候如果想降级到这个版本我们可以使用<a target="_blank" rel="noopener" href="https://github.com/tihmstar/futurerestore">futurerestore</a>，在设备进入kDFU/pwnDFU模式之后用像这样的命令完成降级：</p>
<p>./futurerestore -t xxx.shsh2 –latest-sep –latest-baseband xxxx.ipsw</p>
<p>更新的iPhone和iOS操作似乎还有些不一样，以后如果需要的话再补充。</p>
<p>不过这还没完，苹果还有一个SEP机制(Secure Enclave Processor，安全区域处理器)，如果降级的iOS系统与当前的SEP不兼容，那么降级会被禁止。iOS13范围内SEP都是兼容的，那么你只要备份过对应版本的shsh2文件，就可以在iOS13范围内降级。但是网上我看说如果你升级到iOS14，即使有iOS13的shsh2文件就会因为SEP不兼容无法降级。</p>
<p>所以iOS的越狱降级这些还真的挺头疼的……</p>
<p>最后再扯下如何入门macOS/iOS安全，经过一段时间的探索我有如下想法：</p>
<p>1.学<a target="_blank" rel="noopener" href="http://www.newosxbook.com/index.php">http://www.newosxbook.com/index.php</a>上的三本书，建议海淘。国内那些写macOS/iOS的书我翻了几本得出的结论是都不用买。当然就这么看肯定是非常枯燥的，所以我建议有时间就翻翻，一次也不用看太多。</p>
<p>2.学习各种出现的macOS/iOS漏洞，主要是project zero的。</p>
<p>目前我也是积极在整理这些历史漏洞：<a target="_blank" rel="noopener" href="https://github.com/houjingyi233/macOS-iOS-exploit-writeup">https://github.com/houjingyi233/macOS-iOS-exploit-writeup</a></p>
<p>3.从推特或者关注的大牛那里获取一些他们的研究成果然后学习。</p>
<p>如果遇到其它环境方面的问题我也会继续在这篇文章里面更新，2020年争取也写一些macOS/iOS漏洞研究方面的文章！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/05/%E4%B8%80%E6%AC%A1%E7%BB%99%E7%88%B1%E5%A5%87%E8%89%BASRC%E6%8A%A5%E5%91%8A%E6%BC%8F%E6%B4%9E%E7%9A%84%E7%BB%8F%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/05/%E4%B8%80%E6%AC%A1%E7%BB%99%E7%88%B1%E5%A5%87%E8%89%BASRC%E6%8A%A5%E5%91%8A%E6%BC%8F%E6%B4%9E%E7%9A%84%E7%BB%8F%E5%8E%86/" class="post-title-link" itemprop="url">一次给爱奇艺SRC报告漏洞的经历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-05 14:45:41" itemprop="dateCreated datePublished" datetime="2020-04-05T14:45:41+08:00">2020-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:55:58" itemprop="dateModified" datetime="2021-08-05T09:55:58+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>先给大家看看时间线吧(漏洞已经被修复)：<br>2020-01-06：发现爱奇艺客户端某个需要用户发生交互的场景可以导致远程代码执行，报告到爱奇艺SRC<br>2020-01-08：发现报告被关闭，留言反馈<br>2020-01-09：发送邮件到<a href="mailto:&#55;&#x31;&#115;&#x72;&#x63;&#64;&#113;&#x69;&#x79;&#105;&#x2e;&#x63;&#x6f;&#109;">&#55;&#x31;&#115;&#x72;&#x63;&#64;&#113;&#x69;&#x79;&#105;&#x2e;&#x63;&#x6f;&#109;</a><br>2020-01-09：爱奇艺SRC负责人表示审核人员看错了，让我重复提交一次<br>2020-01-10：重新提交了漏洞<br>2020-02-21：通过QQ向爱奇艺SRC运营反馈这个漏洞不应该被评为中危应该是高危，对方表示会讨论<br>2020-03-06：再次通过QQ向爱奇艺SRC运营询问，对方表示还没有上班<br>2020-04-01：再次通过QQ向爱奇艺SRC运营询问，对方表示这周之内答复<br>2020-04-03：和爱奇艺SRC运营讨论交流，对他们的工作提出了批评和质疑，对方补发了金币和奖励</p>
<p>我不能理解的事情有这么几个：<br>1.市值上百亿美元的美股上市公司审核漏洞为何如此随意？一个能影响爱奇艺windows客户端至少几百万用户的高危漏洞能被审核人员看错直接忽略？我在漏洞下面留言没有回应，直到我发邮件询问。爱奇艺SRC的运营流程和审核人员工作的专业和态度为什么有这么严重的问题？</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXafot.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GX2O0K.png"></p>
<p>2.为什么我联系爱奇艺SRC运营详细说明了我认为为什么应该评高危而不是中危之后，仍然一直不给我答复，期间我不得不两次询问？</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GX2fTU.jpg"></p>
<p>3.我和爱奇艺SRC运营沟通的过程中一直保持文明礼貌，克制自己的情绪，爱奇艺SRC运营为什么给我发送了一个微笑的表情？</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GX27lR.jpg"></p>
<p>4.为什么不给我道歉？是不是爱奇艺SRC觉得白帽子好欺负还是爱奇艺SRC觉得自己很牛逼不需要道歉又或者是爱奇艺SRC觉得自己什么也没有做错？</p>
<p>我那天在朋友圈吐槽完了之后觉得还没有发泄够，于是给<a href="mailto:&#55;&#x31;&#x73;&#114;&#99;&#64;&#113;&#x69;&#121;&#x69;&#x2e;&#99;&#x6f;&#109;">&#55;&#x31;&#x73;&#114;&#99;&#64;&#113;&#x69;&#121;&#x69;&#x2e;&#99;&#x6f;&#109;</a>发了邮件，问了他们这几个问题，同时我也问他们爱奇艺SRC存在的意义是什么？是觉得其它公司有所以我们也要有糊弄一下就行给老板做一下样子还是真的觉得安全问题很重要？</p>
<p>因为我不想再理这群人，所以我邮件里面说请你们不要回复我。之后爱奇艺SRC负责人在之前拉的群里说可以给我补偿一张爱奇艺年卡激活码，当然仍然没有道歉。我不想理他，他加我QQ好友我也没通过，因为我作为一名安全研究人员已经被这家SRC侮辱到体无完肤，我很担心他对我继续进行侮辱。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GX2Tp9.jpg"></p>
<p>我虽然穷但是我不是为了钱，我只是想讲道理。开始认定中危给了我100个积分，死皮烂脸扯了这么久补发了我100个积分，按照爱奇艺SRC上的规定相当于能换300块+300块的京东卡，我特么还真的不在乎。不是说嫌钱少，甲方做安全可能资源是有限的，钱少不是不可以理解，但是该高危为什么要评中危？我也明确承认是需要用户交互的，无意夸大漏洞危害，无交互就应该是“严重”而不是“高危”了。</p>
<p>前段时间一篇文章有人吐槽微博一个漏洞在微博SRC换了一条毛巾。不管是低廉的奖励，不公正的漏洞定级甚至是对安全研究人员言语上的不尊重等等种种侮辱行为我都不是第一个遭遇的，也不会是最后一个，那为什么会出这种事情？</p>
<p>我觉得是跟大环境有关。project zero经常因为90天内厂商没有修复漏洞就披露细节，还有前两年像sandboxescaper这样windows的0day一个接着一个发的。国内你要是敢这么玩轻则被约谈喝茶，重则涉及到的厂商直接起诉你。所以国外厂商普遍也更重视SRC建设，白帽子劳动成果能得到尊重，因为你把人家惹到了直接发0day所有人都会看你笑话。而国内厂商料定白帽子不敢披露漏洞，于是就对白帽子进行各种侮辱。</p>
<p>看起来好像对白帽子披露漏洞不加限制更加危险，实际上是好处大于坏处的。真正像sandboxescaper这样一心搞破坏的人几乎可以忽略不计(看他推现在也好像是被微软招安了)，绝大部分白帽子厂商给了足够的金钱和尊重都不想搞出什么事情。为什么规则应该倾向白帽子还有一个原因是白帽子面对厂商是弱势群体。国内厂商之间各种报团，很多SRC漏洞评价标准都是一起制定的，经常各种开会扯淡拉关系，而白帽子之间很难形成一个类似于工会的组织维护白帽子的权益。不爽了也就只能发个帖子吐吐槽，不然还敢怎么样呢？</p>
<p>这几年网络安全这一行好像还挺火，一直有新人干这行，虽然时不时有白帽子和SRC扯起来但是大大小小的SRC也不愁没有人来报洞。但是国内白帽子这样的生存环境一直持续五年十年之后呢？</p>
<p>更新：不知道为什么爱奇艺SRC的负责人在我写这篇博客的当天就看到了然后来找我了。我不想再说这件事情了，到此为止。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXf6ld.jpg"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXfySH.jpg"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXfrfe.jpg"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXfDYD.jpg"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXfc6A.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/01/%E7%BB%99linux%E5%86%85%E6%A0%B8%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/01/%E7%BB%99linux%E5%86%85%E6%A0%B8%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">给linux内核提交代码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-01 14:45:41" itemprop="dateCreated datePublished" datetime="2019-04-01T14:45:41+08:00">2019-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:56:30" itemprop="dateModified" datetime="2021-08-05T09:56:30+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于如何给linux内核提交代码这个问题其实有官方的非常详细的文档，网上也有很多文章。但是这些文档要么就是太长读不下去要么就是缺乏关键步骤。因为给linux内核提交代码不是在github上pull一个request就完事了，你想想代码那么多，大家天天去pull request人家Linus Torvalds也看不过来。linux内核每个模块的代码是有不同的人负责的，我们想要提交代码需要把patch通过邮件发给对应的维护者。我第一次看如何给linux内核提交代码的官方文档的时候看了下文章长度几乎都想放弃提交了。今天刚好看到一个觉得可以提交的点，所以做一下记录，希望我写的步骤尽量简洁。</p>
<p>首先安装几个必要的软件：<code>sudo apt-get install esmtp mutt vim git</code></p>
<p>vim和git就不用说了，esmtp是mstp的拓展，mutt是linux下收发邮件的程序。</p>
<p>在home目录下创建下面几个配置文件。</p>
<p>.muttrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set sendmail=&quot;/usr/bin/esmtp&quot;</span><br><span class="line">set envelope_from=yes</span><br><span class="line">set from=&quot;Your Name &lt;my.email@gmail.com&gt;&quot;</span><br><span class="line">set use_from=yes</span><br><span class="line">set edit_headers=yes</span><br></pre></td></tr></table></figure>

<p>.esmtprc</p>
<p>设置文件权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod g-rwx ~/.esmtprc</span><br><span class="line">chmod o-rwx ~/.esmtprc</span><br></pre></td></tr></table></figure>

<p>文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">identity &quot;my.email@gmail.com&quot;</span><br><span class="line">hostname smtp.gmail.com:587</span><br><span class="line">username &quot;my.email@gmail.com&quot;</span><br><span class="line">password &quot;ThisIsNotARealPassWord&quot;</span><br><span class="line">starttls required </span><br></pre></td></tr></table></figure>

<p>.gitconfig</p>
<p>文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">   name = Your Name</span><br><span class="line">   email = your.email@example.com </span><br></pre></td></tr></table></figure>

<p>如果你用的是gmail，在“设置”-&gt;“转发和 POP/IMAP”中勾选“启用 IMAP”并保存更改。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXa3GT.png"></p>
<p>需要注意的是这些配置文件中应该用相同的邮箱和姓名，姓名最好填自己的真实姓名，不要填一个奇奇怪怪的。然后我们把内核代码clone下来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</span><br></pre></td></tr></table></figure>

<p>备份原来的文件，修改，生成patch。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SRCTREE= linux</span><br><span class="line">MYFILE=  drivers/net/mydriver.c</span><br><span class="line"></span><br><span class="line">cd $SRCTREE</span><br><span class="line">cp $MYFILE $MYFILE.orig</span><br><span class="line">vi $MYFILE      # make your change</span><br><span class="line">cd ..</span><br><span class="line">diff -up $SRCTREE/$MYFILE&#123;.orig,&#125; &gt; /tmp/patch</span><br></pre></td></tr></table></figure>

<p>用<code>git status</code>命令查看改变了哪些文件。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaYM4.png"></p>
<p>用<code>git diff</code>命令查看具体修改的内容。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaGzF.png"></p>
<p>用<code>git add</code>命令将要提交的文件的信息添加到索引库中。如果再运行<code>git diff</code>命令就看不到之前修改的文件了。运行<code>git status</code>命令可以看到提示信息由<code>Changes not staged for commit</code>变成了<code>Changes to be committed</code>，文件名也由红色变成了绿色。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXa8RU.png"></p>
<p>如果此时想放弃这次修改，可以使用<code>git reset &lt;file&gt;</code>移除已经添加到索引库中的改变。使用<code>git commit -s -v</code>命令提交我们的修改，此时会添加<code>Signed-off-by:</code>这一行。然后我们需要写清楚为什么要这么改。第一行写上”更改的子模块”+”: “+”简要描述修改的内容”。然后接下来再详细描述。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXatsJ.png"></p>
<p>使用<code>git show HEAD</code>命令查看我们的commit。使用<code>git format-patch -o /tmp/ HEAD^</code>生成patch。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaNL9.png"></p>
<p>检查下有无格式错误。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXadd1.png"></p>
<p>看看应该发邮件给谁。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXawIx.png"></p>
<p>前两个maintainer是收件人，需要抄送给open list。我们最好先给自己发一封邮件再次确认一切无误。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaBi6.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaDJK.png"></p>
<p>好了，现在可以发邮件了。之后就是等待给我们回复，可能会接受我们的commit，可能会拒绝我们的commit，可能会要求我们再修改，这都很正常。接受我们的commit之后还需要等一段时间才会被加入内核代码。到时候你会还收到邮件。比如我的commit是6月19日被接受的，7月2日被加到4.14/4.19/5.1-stable tree中。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXarRO.png"></p>
<p>如果你用的不是gmail或者不想用mutt一些步骤可能会不太一样。建议参考下面两份官方文档。</p>
<p>1.<a target="_blank" rel="noopener" href="https://kernelnewbies.org/FirstKernelPatch">FirstKernelPatch</a></p>
<p>2.<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/v4.18/process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/01/%E8%AF%BB%E3%80%8AMalware%20Data%20Science%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/01/%E8%AF%BB%E3%80%8AMalware%20Data%20Science%E3%80%8B/" class="post-title-link" itemprop="url">读《Malware Data Science》</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-01 14:45:41" itemprop="dateCreated datePublished" datetime="2019-04-01T14:45:41+08:00">2019-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:55:32" itemprop="dateModified" datetime="2021-08-05T09:55:32+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今年一直在强迫自己有空多看点书，会慢慢分享一些读后感。</p>
<p>《Malware Data Science》这本书读之前我的期望比较高，虽然我没打算深入做这个方向，但是现在太多关于病毒分析的书了，写来写去都是那些东西，有这么一本从数据科学的角度讲病毒分析的书感觉很难得。但是大致读完之后，还是有点失望。满分100分只能打个60分，个人觉得属于读不读都可以的那种。</p>
<p>这本书一共有12章，第1章是介绍，第2章是静态分析，第3章是动态分析，可以直接跳过。下面重点说第4章到第12章。</p>
<p>第4章：教你怎么画图来识别攻击活动。书上举的两个例子一是把相同CC的样本连在一起，二是把含有相同图片的样本连在一起，分别用的APT1和木马样本。大概效果像下面这样。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUX8O.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUOPK.png"></p>
<p>大家都懂的，想看的话就别指望国内出翻译版了。</p>
<p>这种系统首先就是大名鼎鼎的virustotal的VTgraph了，virustotal官方还出了个virustotal的教程：<a target="_blank" rel="noopener" href="https://storage.googleapis.com/vt-gtm-wp-media/virustotal-for-investigators.pdf">https://storage.googleapis.com/vt-gtm-wp-media/virustotal-for-investigators.pdf</a></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaVxg.png"></p>
<p>国内这样的系统还有腾讯的安图，前几天它们一篇文章中判断今年几个影响恶劣的病毒团伙背后是同一个犯罪组织：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tmNYp1WHtUxYRE3aRQNUeA">https://mp.weixin.qq.com/s/tmNYp1WHtUxYRE3aRQNUeA</a></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaeMQ.png"></p>
<p>当然还有360网络研究院大数据关联平台和360威胁情报中心(现更名为奇安信威胁情报中心)威胁分析平台：<a target="_blank" rel="noopener" href="https://ti.360.net/blog/articles/apt-c-27-(goldmouse):-suspected-target-attack-against-the-middle-east-with-winrar-exploit/">https://ti.360.net/blog/articles/apt-c-27-(goldmouse):-suspected-target-attack-against-the-middle-east-with-winrar-exploit/</a></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaERS.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaAG8.png"></p>
<p>还有微步在线等平台，就不一一列举了。</p>
<p>第5章：共享代码识别，这个其实是很有用的一个功能。比如为什么说VPNFilter与BlackEnergy有关，因为它们都用了相同的方式去修改RC4算法进行加密，如果在分析的时候有这样一个共享代码识别的系统，样本扔进去就跑出来识别出共享了BlackEnergy的代码，能省很多精力和时间。这样的系统目前intezer有一个。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUj2D.png"></p>
<p>这个是免费的，花钱可以有更多高级功能。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUbUx.png"></p>
<p>书上说了有这么几个方法识别二进制文件共享代码：汇编指令，字符串，IAT表，动态API调用。我估计intezer大概主要也就是汇编指令和字符串。最后基于字符串做了一个简单的命令行查询系统。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUq56.png"></p>
<p>还有一个开源的IDA插件Kam1n0，是2015年IDA插件大赛的第二名：<a target="_blank" rel="noopener" href="https://github.com/McGill-DMaS/Kam1n0-Community">https://github.com/McGill-DMaS/Kam1n0-Community</a></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaMaq.png"></p>
<p>第6章：扯了一些机器学习的概念。介绍了机器学习的步骤，特征空间和决策边界概念，模型的过拟合和欠拟合问题，和几个机器学习的算法：逻辑回归，KNN，决策树和随机森林。</p>
<p>第7章：扯了一些机器学习的评价指标。TP、TN、FP、FN，ROC，Precision，TPR，FPR等等。懂机器学习的话，这两章可以直接跳过。</p>
<p>第8章：先用是否被加密和压缩这两个指标作为特征，决策树作为算法写了一个判定恶意文件和正常文件的很简单的示例代码。然后实现了一个更接近实际用的，提取字符串作为特征，随机森林作为算法。</p>
<p>第9章：可视化，教你怎么画一些比较高大上的图，随便截了几张。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUvxe.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXaSrd.png"></p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXUzKH.png"></p>
<p>第10章：扯了一些深度学习的概念。神经网络原理是什么，怎么训练神经网络，最后介绍了几种神经网络：前向神经网络，卷积神经网络，自编码神经网络，生成对抗网络，循环神经网络和残差网络。懂的话也可以直接跳过。</p>
<p>第11章：用神经网络检测恶意HTML页面。</p>
<p>第12章：怎么成为一个数据科学家，随便扯扯。</p>
<p>数据科学用于病毒分析当然能做很多有趣的事情。但是打60分的原因是觉得翻翻还是可以，例子都太简单了，机器学习/深度学习这种玄学类的东西，举那么简单的例子基本等于没有举，真正用于实践会遇到很多问题。</p>
<p>其实我是买了书的，但是纸质看起来不太方便，又找了好久才找到pdf，想看看这本书又找不到pdf的话：aG91amluZ3lpMTU5。</p>
<p><img src="https://s1.ax1x.com/2020/04/13/GXapqA.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/01/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%AD%A3%E5%BC%8F%E4%B8%8A%E7%BA%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="houjingyi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="houjingyi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/01/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%AD%A3%E5%BC%8F%E4%B8%8A%E7%BA%BF/" class="post-title-link" itemprop="url">个人博客正式上线</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-01 14:45:41" itemprop="dateCreated datePublished" datetime="2018-11-01T14:45:41+08:00">2018-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-05 09:56:16" itemprop="dateModified" datetime="2021-08-05T09:56:16+08:00">2021-08-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大二的时候开始写博客，现在觉得还是应该有一个自己的网站，希望能自己总结知识的同时帮助别人学习:)</p>
<p><strong>所有在本网站和第三方平台发表的文章未经许可，请勿转载</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">houjingyi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">houjingyi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
